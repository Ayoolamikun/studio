/**
 * @file firestore.rules
 * @description Firestore Security Rules for a public application submission system.
 *
 * @version 1.0.0
 *
 * ## Core Philosophy
 * This ruleset enforces a "write-once, read-never" security model for all client-side
 * operations. The primary goal is to allow anyone, including anonymous users, to submit
 * data through forms (e.g., loan applications, contact messages) while strictly
 * prohibiting any client from reading, updating, or deleting that data. All submitted
 * data is considered private and is intended to be processed exclusively by a secure
 * backend or administrative panel with privileged access.
 *
 * ## Data Structure
 * The data is organized into four distinct top-level collections:
 * - /loanApplications
 * - /investmentApplications
 * - /membershipApplications
 * - /contactMessages
 *
 * This flat, segregated structure ensures that different types of submissions are kept
 * separate, allowing for clear and simple security rules without complex dependencies.
 *
 * ## Key Security Decisions
 * - **Public Write Access:** The `create` operation is intentionally left open (`if true`)
 *   for all collections. This allows public-facing web forms to submit data without
 *   requiring a user to be fully signed in, supporting anonymous submissions.
 * - **Strict Read/Modify Denial:** All read (`get`, `list`), update, and delete
 *   permissions are explicitly denied (`if false`). This is the core of the security
 *   model, protecting sensitive submitted information from being exposed to other users.
 * - **No Data Validation:** In this prototyping stage, the rules do not validate the
 *   shape or content of the data being written. The focus is solely on authorization
 *   (i.e., who can perform an action), not on data integrity.
 * - **Authorization Independence:** The rules for any given document do not depend on
 *   the contents of any other document, which leads to simple, fast, and scalable
 *   security enforcement.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ------------------------------------------------------------------------
    // Helper Functions
    // ------------------------------------------------------------------------

    /**
     * Checks if a user is authenticated (either signed-in or anonymous).
     * While not used in the current ruleset, it's a standard utility.
     */
    function isSignedIn() {
      return request.auth != null;
    }


    // ------------------------------------------------------------------------
    // Collection: loanApplications
    // ------------------------------------------------------------------------

    /**
     * @description Allows any user (including anonymous) to submit a loan application
     *              but prevents anyone from reading, updating, or deleting existing ones.
     * @path        /loanApplications/{loanApplicationId}
     * @allow       Any user (anonymous or signed-in) can (create) a new document.
     * @deny        Any user attempting to (get), (list), (update), or (delete) a document.
     * @principle   Enforces a "write-once, read-never" policy for public submissions.
     *              This protects sensitive applicant data from client-side access.
     */
    match /loanApplications/{loanApplicationId} {
      allow get: if false;
      allow list: if false;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }


    // ------------------------------------------------------------------------
    // Collection: investmentApplications
    // ------------------------------------------------------------------------

    /**
     * @description Allows any user (including anonymous) to submit an investment application
     *              but prevents anyone from reading, updating, or deleting existing ones.
     * @path        /investmentApplications/{investmentApplicationId}
     * @allow       Any user (anonymous or signed-in) can (create) a new document.
     * @deny        Any user attempting to (get), (list), (update), or (delete) a document.
     * @principle   Enforces a "write-once, read-never" policy for public submissions.
     *              This protects sensitive applicant data from client-side access.
     */
    match /investmentApplications/{investmentApplicationId} {
      allow get: if false;
      allow list: if false;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }


    // ------------------------------------------------------------------------
    // Collection: membershipApplications
    // ------------------------------------------------------------------------

    /**
     * @description Allows any user (including anonymous) to submit a membership application
     *              but prevents anyone from reading, updating, or deleting existing ones.
     * @path        /membershipApplications/{membershipApplicationId}
     * @allow       Any user (anonymous or signed-in) can (create) a new document.
     * @deny        Any user attempting to (get), (list), (update), or (delete) a document.
     * @principle   Enforces a "write-once, read-never" policy for public submissions.
     *              This protects sensitive applicant data from client-side access.
     */
    match /membershipApplications/{membershipApplicationId} {
      allow get: if false;
      allow list: if false;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }


    // ------------------------------------------------------------------------
    // Collection: contactMessages
    // ------------------------------------------------------------------------

    /**
     * @description Allows any user (including anonymous) to submit a contact message
     *              but prevents anyone from reading, updating, or deleting them.
     * @path        /contactMessages/{contactMessageId}
     * @allow       Any user (anonymous or signed-in) can (create) a new document.
     * @deny        Any user attempting to (get), (list), (update), or (delete) a document.
     * @principle   Enforces a "write-once, read-never" policy for public submissions,
     *              securing messages for backend-only review.
     */
    match /contactMessages/{contactMessageId} {
      allow get: if false;
      allow list: if false;
      allow create: if true;
      allow update: if false;
      allow delete: if false;
    }
  }
}