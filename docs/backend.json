{
  "entities": {
    "Borrower": {
      "title": "Borrower",
      "type": "object",
      "description": "Represents a borrower (customer) in the system.",
      "properties": {
        "name": { "type": "string", "description": "Full name of the borrower." },
        "phone": { "type": "string", "description": "Phone number of the borrower." },
        "email": { "type": "string", "description": "Email of the borrower.", "format": "email" },
        "bvn": { "type": "string", "description": "Bank Verification Number of the borrower." },
        "employment": { "type": "string", "description": "Place of employment." },
        "address": { "type": "string", "description": "Home address of the borrower." },
        "passportUrl": { "type": "string", "description": "URL to the passport photograph in Firebase Storage." },
        "idDocumentUrl": { "type": "string", "description": "URL to the ID document in Firebase Storage." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of creation." }
      },
      "required": ["name", "phone", "email", "bvn", "employment", "address", "createdAt"]
    },
    "Loan": {
      "title": "Loan",
      "type": "object",
      "description": "Represents a loan application and its status.",
      "properties": {
        "borrowerId": { "type": "string", "description": "ID of the borrower from the Borrowers collection." },
        "amountRequested": { "type": "number", "description": "The principal amount requested." },
        "duration": { "type": "number", "description": "Loan duration in months." },
        "interestRate": { "type": "number", "description": "The flat interest rate applied." },
        "totalRepayment": { "type": "number", "description": "Total amount to be repaid (Principal + Interest)." },
        "amountPaid": { "type": "number", "description": "Total amount paid back by the borrower so far." },
        "balance": { "type": "number", "description": "The remaining balance to be paid." },
        "status": { "type": "string", "description": "Status of the loan.", "enum": ["pending", "approved", "rejected", "active", "paid", "overdue"] },
        "notes": { "type": "string", "description": "Admin notes regarding the loan." },
        "excelImported": { "type": "boolean", "description": "Flag if the loan was created/updated from an Excel import." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of loan application." }
      },
      "required": ["borrowerId", "amountRequested", "duration", "status", "createdAt"]
    },
    "ExcelFile": {
      "title": "ExcelFile",
      "type": "object",
      "description": "Metadata for an uploaded Excel file for monthly imports.",
      "properties": {
        "fileUrl": { "type": "string", "description": "URL to the raw Excel file in Firebase Storage." },
        "uploadedAt": { "type": "string", "format": "date-time", "description": "Timestamp of upload." },
        "processed": { "type": "boolean", "description": "Whether the file has been processed by the Cloud Function." }
      },
      "required": ["fileUrl", "uploadedAt", "processed"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/Borrowers/{borrowerId}",
        "definition": {
          "entityName": "Borrower",
          "schema": { "$ref": "#/entities/Borrower" },
          "description": "Stores all borrower profile data. Admins have full access. Borrowers can read/update their own data.",
          "params": [{ "name": "borrowerId", "description": "Unique ID for the borrower, typically the Firebase Auth UID." }]
        }
      },
      {
        "path": "/Loans/{loanId}",
        "definition": {
          "entityName": "Loan",
          "schema": { "$ref": "#/entities/Loan" },
          "description": "Stores all loan records. Linked to a borrower by borrowerId. Admins have full access. Borrowers can only read loans where their UID matches the borrowerId.",
          "params": [{ "name": "loanId", "description": "Unique ID for the loan." }]
        }
      },
      {
        "path": "/ExcelFiles/{excelId}",
        "definition": {
          "entityName": "ExcelFile",
          "schema": { "$ref": "#/entities/ExcelFile" },
          "description": "Stores metadata for uploaded Excel files for batch processing. Admin-only access.",
          "params": [{ "name": "excelId", "description": "Unique ID for the Excel file record." }]
        }
      },
       {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminUser",
          "schema": {
            "$ref": "#/backend/entities/AdminUser"
          },
          "description": "Stores admin roles. Existence of a document indicates admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user with admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The structure is designed to segregate borrower profiles from their loans for better data management and security. The Borrowers collection acts as the single source of truth for user information, linked via a Firebase Auth UID. The Loans collection contains all financial transaction details, referencing the borrower's ID. This allows a borrower to have multiple loans over time. The ExcelFiles collection is for admin use, tracking batch imports. Security rules will enforce that borrowers can only see their own data, while admins have broader access."
  }
}
